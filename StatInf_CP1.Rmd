---
title: "A Demonstration of the Central Limit Theorem "
author: "A.K.N"
output:
  pdf_document:
    fig_height: 4
    fig_caption: yes
    keep_tex: yes
    latex_engine: xelatex
  html_document: default
---
#Overview
  In this report, we will simulate sampling a mean from an exponential distribution. We will investigate the sample mean and variance and compare it to the theoretical mean and variance. Finally, we will demonstrate the Central Limit Theorem by showing that the distribution of the mean is normally distributed. 
```{r setup, cache=TRUE, echo=FALSE, results='hide', warning=FALSE, message=FALSE}
#required packages for report
library(ggplot2)
library(reshape2)
library(knitr)
library(grid)  #required for some of the ggplot theme() elements (like 'unit')
library(gridExtra)
#cleanup
rm(list=ls())
```

#Simulations  
  We wish to simulate sampling the mean of an exponentially distributed random variable. The rate parameter, $\lambda$, is set to 0.2. We run 1000 simulations of taking the mean of a sample of $n = 40$ exponentials. The sample means are calculated and saved to a data frame along with a set of 1000 random exponentials.  
```{r sims, dependson="setup", cache=TRUE}

n = 40  #sample size
reps = 1000 #number of simulations
lambda = 0.2
set.seed(936907)
#Simulations
samples <- replicate(reps, rexp(n,lambda))
a <- rexp(reps, lambda); b <- apply(samples, 2, mean)
data <- data.frame(exp = a, means = b)
#Calculations
mu = 1/lambda; s = (1/lambda)/sqrt(n); sigma = s^2 #theoretical mu, sigma and s
obmean <- mean(data$means) #observed mu
sd_sample_mean <- sd(data$means); var_sample_mean <- var(data$means) #obs. s and sigma  
```  

#Sample Mean and Variance vs. Theoretical Mean and Variance  
  The exponential distribution has a theoretical mean equal to the inverse of rate parameter, $\frac{1}{\lambda}=5$. The sample mean $bar(x)$, is an estimate of the population mean. The standard deviation of an exponential distribution is also $s = \frac{1}{\lambda} = 5$. Since the variance is $\sigma=s^2$, the variance of an exponential distribution with $\lambda = 0.2$ would be $5^2 = 25$. However, in this case we wish to calulcate the variance of the distribution of the sample means. Therefore: 
  $$s = \frac{1}{\lambda * \sqrt{n}} = \frac{5}{\sqrt{40}} =  0.79 \text{ and } \sigma = s^2 = 0.625$$  
  These theoretical values are compared to the values from the simulated sample means in _Figure 1_. The left panel shows a histogram of the distribution of sample means. Two lines mark the location of the center of the distribution(blue), and the theoretical center (red).  
```{r fig1, dependson=c("setup", "sims"), echo=FALSE, warning=FALSE, cache=TRUE, fig.cap="Charecteristics of the Distibution"}
#Table 1
labels <- c("Mean", "SD", "Variance") 
theory <-  round(c(mu, s, sigma), digits = 3)
sims <- round(c(obmean, sd_sample_mean, var_sample_mean), digits = 3)
table1 <- cbind(Variable = labels, Theoretical=theory, Observed = sims)

#Plot 1
p1 <- ggplot(data=data, aes(x=b)) + geom_histogram(stat="bin", binwidth=0.5, fill="white", color="grey") + labs(x="Sample Mean", y="Count", title="Distribution of Sample Means") + geom_vline(color="red", xintercept=mu) +  geom_vline(xintercept=obmean, color="blue") + theme(plot.title = element_text(size = 10), axis.title.x=element_text(size=8), axis.title.y=element_text(size=8)) 
#cFigure 1
grid.arrange(tableGrob(table1), p1, nrow=2, heights=c(0.75,1))
```

#Distributions  
  We will use our simulated data to test the central limit theorem. By the CLT, the simulated sample mean will have a normal distribution, despite the shape of the underlying distribution. If one takes enough samples, the mean of those samples will be _normally_ distributed. 
  First, with our simulated data, we can construct a 95% CI for sample mean and compare it to the 95% CI for a normal distribution of mean $\frac{1}{\lambda}$.
```{r CIs, dependson=c("setup", "sims"), echo=TRUE, warning=FALSE, cache=TRUE}
#Construct a CI for the sample mean
sample95CI <- obmean + c(-1,1)*qt(0.975, n-1) * (sd_sample_mean/sqrt(n))
normal95CI <- mu + c(-1,1)*1.96*(s/sqrt(n))
rbind(sample95CI, normal95CI)
```  
  Thus far, the parameters of the simulated distribution are very similar to the theoretical values. Next, we can visually compare the distribution of a large number of means of exponentials to the distribution of a large number of exponentials. In _Figure 2_, we use density plots to compare the shapes of these two distributions. In the left panel of _Figure 2_, we can see that the shape of the distribution of means is normal even though the exponential distribution is not. For reference, we overlay a plot of a normal distribution of n = 1000, centered around $\mu$. The right panel provides another way to confirm the normality of the distribution of means: the quantile-quantile plot, or Q-Q plot. This plot shows that the sample quantiles are very close to the theoretical quantiles, another indication that the distribution is in fact normal. 

```{r fig2, dependson=c("setup","sims"), echo=FALSE, warning=FALSE, cache=TRUE, fig.cap="Demonstrating that the Distribution of Sample Means is Normal"}

data2 <- melt(data, value.name = "Value", measure.vars = c("exp", "means"))
p3 <- ggplot(data2, aes(x=Value, fill=variable)) + geom_histogram(aes(y = ..density..), binwidth=0.5)
p3 <- p3 + coord_cartesian(xlim=c(0,10)) + stat_function(fun = dnorm, args = list(mean=1/lambda, sd = s), n = reps, color="black", lty=5, lwd=1.5) + scale_fill_discrete(name=element_blank(),breaks=c("exp", "means"),
                                   labels=c("Exponential\nDistribution", "Sample Mean\nDistribution")) + theme(legend.position=c(0.25,0.9), legend.text = element_text(size = 6), legend.key.size=unit(0.6, "cm"), legend.background=element_rect(fill="transparent")) + labs(title = "A population of random exponentials\nvs. Sample means of random exponentials") + theme(plot.title = element_text(size = 10), axis.title.x=element_text(size=8), axis.title.y=element_text(size=8))


##Q-Q plot
p4 <- ggplot(data, aes(sample=b)) + stat_qq(shape=1) + geom_abline(intercept=mu, slope=s, color="red") + labs(title="Q-Q plot") + theme(plot.title = element_text(size = 10), axis.title.x=element_text(size=8), axis.title.y=element_text(size=8))

#combine
grid.arrange(p3,p4, ncol=2)
```  

#Conclusions  
  1. We simulated sampling the mean of an exponential distribution. The simulated mean was `r round(obmean, digits=3)`, close to the theoretical mean, `r mu`.  
  2. The simulated variance, `r sigma`, was cloe to the variance of the sampled means, `r round(var_sample_mean, digits=3)`.  
  3. The two endpoints of the 95% CI of the distribution of sample means, `r round(sample95CI, digits=3)`, match closely the 95% CI of a normal distribution centered at $\mu$, `r normal95CI`.  
  4. We began with a population of exponentals that were not normally distributed. Then, we took the means of many samples of size $n$. The distribution of these sample means _are normally distributed_. This is the main prediction of the Central Limit Theorem. 
  

_Note:_ Code for graphs not included in this report due to space limits, but markdown file can be found [here](https://github.com/anandi42/Stat_Inf/blob/master/StatInf_CP1.Rmd).



```{r cleanup, dependson=c("setup", "sims"), echo=FALSE, warning=FALSE}
#save results of simulation
write.csv(samples, file = "samples.csv"); write.csv(data, file="data.csv")
rm(list=ls())
```  


