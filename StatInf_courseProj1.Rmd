---
title: "Demonstrating the Central Limit Theorem with Simulated Sample Means"
author: "AKN"
date: "Sunday, September 27, 2015"
output:
  pdf_document:
    fig_caption: yes
    fig_height: 3
    keep_tex: yes
    latex_engine: xelatex
  html_document: default
---


#Overview
In this report, we will simulate sampling a mean from a random exponential distribution in R. We will investigate the sample mean and the variance of the distribution and compare it to the theoretical mean and variance. Finally, we will demonstrate the Central Limit Theorem by showing that the distribution of the mean is normally distributed. 

```{r setup, cache=TRUE, echo=FALSE, results='hide', warning=FALSE, message=FALSE}
library(ggplot2)
library(reshape2)
library(knitr)
```


#Simulations  

We wish to simulate sampling the mean of an exponentially distributed random variable. The rate parameter, $\lambda$, is set to 0.2. We run 1000 simulations of taking the mean of a sample with $n = 40$. We also simulate the distribution of a large set of random exponentials. We will, later, compare these two distributions. For now, the results of sampling the mean are stored to a dataframe, along with the large set of random exponentials. 


```{r sims, dependson=1, cache=TRUE}
n = 40
reps =1000
lambda = 0.2
set.seed(92715)
a <- rexp(reps, lambda)
b <- replicate(reps, mean(rexp(n,lambda)))
data <- data.frame(exp = a, means = b)
```

#Sample Mean and Variance vs. Theoretical Mean and Variance  

The exponential distribution has a theoretical mean equal to the inverse of rate parameter, $\lambda$:   

  $$ \frac{1}{\lambda} = \frac{1}{0.2} = 5 $$.  
  
As for the variance, we know that the standard deviation of an exponential distribution is also $\frac{1}{\lambda}$. For a sample of n observations, then, the theoretical variance is:  
  
  $$ \frac{1}{\lambda\sqrt(n)} = \frac{1}{0.2\sqrt(40)} = 0.7906 $$  
  
How does the theoretical mean/variance compare to the observed mean/variance of 1000 means of a set of 40 random exponentials? As shown in the table below, the observed values are close to, but do not equal the theoretical mean and variance.  


```{r means, dependson=1, echo=FALSE, results='asis', warning=FALSE}
thmean = 1/lambda
thvar = 1/(lambda*sqrt(n))
obmean <- mean(data$means)
obvar <- var(data$means)
labels <- c("Observed Mean", "Observed Variance", "Theoretical Mean", "Theoretical Variance") 
vals <- c(obmean, obvar, thmean, thvar)
library(knitr)
kable(cbind(Variable = labels, Value=vals), digits=4)
```

#Distributions  

  We will use our simulated data to test the central limit theorem. By the CLT, the simulated sample mean will have a normal distribution, given a sufficiently large number of iid. That is, despite the shape of the underlying distribution, if one takes enough samples, the mean of those samples will be _normally_ distributed. We previously took advantage of this fact to calculate the theoretical variance above.  
   
  
  Now, we can confirm the shape of the distribution of means and compare it to the distribution of a large set of random exponentials. A crude and simple way to do this is by visual inspection. The first plot below shows the density of the sample means, and compares it to the distribution of 1000 exponentials. For reference, we overlay a plot of a normal distribution of n = 1000, centered around the calculated theoretical mean. 
  

```{r plot1, dependson=c(1,2), echo=FALSE, warning=FALSE, fig.height=4,fig.cap="Density Plots"}
library(reshape2)
library(ggplot2)
data2 <- melt(data, value.name = "Value", measure.vars = c("exp", "means"))
p <- ggplot(data2, aes(x=Value, fill=variable)) + geom_histogram(aes(y = ..density..), binwidth=0.5)
p <- p + coord_cartesian(xlim=c(0,10)) + stat_function(fun = dnorm, args = list(mean=1/lambda, sd = thvar), n = reps, color="black")
p <- p + scale_fill_discrete(name=" ",breaks=c("exp", "means"),
                                   labels=c("Population Distribution", "Distribution of Sample Means"))
print(p)
```

The second plot below provides a formal way to check the normality of the distribution of means: the quantile-quantile plot, or Q-Q plot. This directly plots the quantiles of one set of data against another, in this case, it is our sample means vs. the normal distribution. 


```{r plot2, echo=FALSE, dependson=c(1,2), fig.height=4, fig.cap="Q-Q plot"}
qqnorm(data$means)
qqline(data$means)
```

#Conclusions  

  1. The observed mean, `r obmean` is close to the calculated theoretical mean, `r thmean`.  
  2. The observed variance, `r obvar` is near the calculated theoretical mean, `r thvar`.  
  3. The distribution of the sample means, at 1000 iterations, has a density function that looks approxiametly normal, and when plotted against the normal dist on a Q-Q plot, shows high agreement with the normal distribution.  
  4. The distribution of the mean of 40 exponentials approaches a normal distribution when observing 1000 simulated samples. 